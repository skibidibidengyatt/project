<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лекция № 10 - Понятие прерывания</title>
</head>
<body>
    <h1>Лекция № 10</h1>
    <h2>Понятие прерывания. Последовательность действий при обработке прерываний. Классы прерываний. Рабочая область прерываний</h2>

    <p>Прерывания – механизм, позволяющий координировать параллельное функционирование отдельных устройств вычислительной системы и реагировать на особые состояния, возникающие при работе процессора. Это принудительная передача управления от выполняемой программы к системе (а через нее – к соответствующей программе обработки прерывания), происходящая при возникновении определенного события. Прерывания используются для реализации асинхронных событий, таких как взаимодействие с внешними устройствами (клавиатура, мышь, диск), таймеры, ошибки и другие события, которые требуют немедленного внимания процессора.</p>
    
    <p>Идея прерываний была предложена в середине 50-х годов и можно без преувеличения сказать, что она внесла наиболее весомый вклад в развитие вычислительной техники.</p>
    
    <p>Основная цель введения прерываний — реализация асинхронного режима работы и распараллеливание работы отдельных устройств вычислительного комплекса.</p>
    
    <p>Процессор в обычной ситуации выполняет программу, инструкцию за инструкцией. Однако, когда возникает прерывание, процессор временно прекращает выполнение текущей инструкции и переключается на обработку события, которое вызвало прерывание. После обработки прерывания процессор возвращается к выполнению программы с того места, где она была прервана.</p>
    
    <p>Механизм прерываний реализуется аппаратно-программными средствами. Структуры систем прерывания (в зависимости от аппаратной архитектуры) могут быть самыми разными, но все они имеют одну общую особенность — прерывание непременно влечет за собой изменение порядка выполнения команд процессором.</p>

    <h3>Последовательность действий при обработке прерываний</h3>
    <p>Когда возникает прерывание, процессор должен выполнить несколько последовательных шагов:</p>
    
    <ol>
        <li>Определение приоритета прерывания:
            Прерывания могут иметь разный приоритет. Если несколько прерываний происходят одновременно, процессор должен решить, какое из них обработать в первую очередь. Это может зависеть от настроек системы и приоритетов, установленных для каждого типа прерывания.</li>
        
        <li>Сохранение состояния процессора:
            Прежде чем переключиться на обработку прерывания, процессор должен сохранить информацию о текущем состоянии выполнения программы (например, содержимое регистров (Регистр процесса — это специализированный тип памяти в центральном процессоре (ЦП), который используется для хранения данных и инструкций в ходе выполнения программ. Регистры являются высокоскоростными ячейками памяти, которые позволяют процессору быстро получать доступ к данным и выполнять вычисления.), флаги состояния (Флаги состояния — это специальные биты в регистре Состояния (Status Register) центрального процессора, которые указывают на текущее состояние процессора и результат выполнения арифметических и логических операций. Они помогают процессору принимать решения о дальнейших действиях на основе результатов предыдущих операций.) и указатель программы). Это необходимо, чтобы после завершения обработки прерывания процессор мог вернуться к выполнению программы с того места, где она была прервана.</li>
        
        <li>Переход в режим обработки прерывания:
            Процессор переключается в специальный режим, предназначенный для обработки прерываний. В этом режиме доступ к памяти и ресурсам может быть ограничен, и процессор начинает выполнять специальную программу — обработчик прерывания.</li>
        
        <li>Выполнение обработчика прерывания:
            Обработчик прерывания — это специализированная часть кода, которая выполняется для решения проблемы, вызвавшей прерывание. Например, если прерывание было вызвано устройством ввода/вывода, то обработчик может получить данные с устройства или отправить команду на устройство.</li>
        
        <li>Возврат к обработке основной программы:
            После завершения работы обработчика прерывания процессор восстанавливает сохраненное состояние и продолжает выполнение основной программы с того места, где оно было прервано.</li>
    </ol>
    
    <p>Итак, главные функции механизма прерываний:</p>
    <ul>
        <li>распознавание или классификация прерываний;</li>
        <li>передача управления соответственно обработчику прерываний;</li>
        <li>корректное возвращение к прерванной программе.</li>
    </ul>

    <h3>Классы прерываний</h3>
    <p>Прерывания классифицируются по нескольким признакам. Основные классы прерываний:</p>
    
    <ol>
        <li>Аппаратные (асинхронные или внешние) прерывания (Hardware Interrupts):
            Эти прерывания возникают от аппаратных устройств, таких как клавиатура, мышь, сетевые адаптеры или внешние устройства. Аппаратные прерывания могут быть вызваны различными событиями:
            <ul>
                <li>Запрос на чтение/запись данных с устройства.</li>
                <li>Ошибки оборудования (например, сбой жесткого диска).</li>
                <li>Таймеры (например, срабатывание системного таймера).</li>
            </ul>
        </li>
        
        <li>Программные (синхронные или внутренние) прерывания (Software Interrupts):
            Программные прерывания возникают в результате выполнения программного кода, а не внешних событий. Программные прерывания могут быть вызваны:
            <ul>
                <li>Ошибками в программе (например, деление на ноль, выход за пределы массива).</li>
                <li>Системными вызовами, когда программа просит операционную систему выполнить какие-то действия (например, ввод/вывод, выделение памяти).</li>
            </ul>
        </li>
        
        <li>Прерывания от исключений (Exceptions):
            Исключения представляют собой особый вид прерываний, которые возникают в случае ошибок выполнения программы, таких как:
            <ul>
                <li>Деление на ноль.</li>
                <li>Нарушение прав доступа к памяти (например, попытка записи в защищенную область памяти).</li>
                <li>Невозможно выполнить инструкцию, так как она не поддерживается процессором.</li>
            </ul>
        </li>
        
        <li>Прерывания от внешних событий (External Interrupts):
            Эти прерывания возникают от внешних факторов, например, сигналов от внешних устройств. Это может быть прерывание от клавиатуры или других периферийных устройств.</li>
    </ol>

    <h3>Рабочая область прерываний</h3>
    <p>Рабочая область прерываний (или контекст прерывания) — это область памяти, где хранятся данные, необходимые для восстановления состояния программы после обработки прерывания. Рабочая область прерываний включает в себя:</p>
    
    <ul>
        <li>Сохраненные регистры процессора — для того чтобы можно было восстановить текущее состояние выполнения программы после обработки прерывания.</li>
        <li>Флаги и другие параметры состояния процессора — чтобы можно было точно восстановить состояние флагов и других вспомогательных данных.</li>
        <li>Местоположение обработки прерывания — это может быть указатель на специальную таблицу обработки прерываний (например, в современных системах используется таблица прерываний).</li>
    </ul>
    
    <p>Каждое прерывание требует выделения определенной рабочей области, которая будет использоваться для хранения контекста текущего выполнения.</p>

    <h3>Пример обработки прерываний в процессоре</h3>
    <p>Для иллюстрации, рассмотрим процесс обработки прерывания на примере работы процессора x86:</p>
    
    <ol>
        <li>Процессор получает сигнал от устройства ввода/вывода (например, клавиатуры).</li>
        <li>Процессор останавливает выполнение текущей программы.</li>
        <li>Сохраняется контекст работы (значения регистров и указатель на следующую инструкцию).</li>
        <li>Выполняется переход к обработчику прерывания, который находится в специальной таблице прерываний.</li>
        <li>Обработчик выполняет необходимые действия, такие как считывание символа с клавиатуры.</li>
        <li>После завершения обработки прерывания процессор восстанавливает сохраненный контекст.</li>
        <li>Процессор продолжает выполнение программы с того места, где было выполнено прерывание.</li>
    </ol>

    <h3>Заключение</h3>
    <p>Прерывания являются важным механизмом в современных вычислительных системах. Они обеспечивают асинхронное реагирование процессора на события, что позволяет эффективно управлять взаимодействием с внешними устройствами и организовывать многозадачность в операционных системах.</p>
    
    <p>Правильная обработка прерываний требует четкой координации действий процессора, операционной системы и периферийных устройств. Знание механизмов обработки прерываний, классификации их типов и особенностей работы с рабочей областью прерываний является основой для более глубокого понимания принципов работы вычислительных систем.</p>

    <h3>Контрольные вопросы</h3>
    <ol>
        <li>Что такое прерывание?</li>
        <li>В чем заключается основная цель использования прерываний в вычислительных системах?</li>
        <li>Что происходит при возникновении прерывания?</li>
        <li>Почему необходимо сохранять состояние процессора при обработке прерывания?</li>
        <li>Какие виды прерываний существуют и чем они отличаются?</li>
        <li>Что происходит после завершения обработки прерывания?</li>
        <li>Что такое рабочая область прерываний и какие данные в ней хранятся?</li>
        <li>Почему важно правильно организовать обработку прерываний в многозадачной системе?</li>
    </ol>

    <a href="lect10-2.html">См. ответы</a>
</body>
</html>